import{_ as e,a as t,b as a,m as s,h as r,o as i,i as n,k as l,t as d,z as o,w as u,n as m,q as f,j as c,v as _,F as p,p as h}from"./app-0e743bd7.js";const v={data:()=>({v$:t(),form:{refund_items:[],refund_reasons:[],refund_note:"",attachments:null},orderCode:null,order:{},loading:!1}),validations:{form:{refund_reasons:{},refund_note:{required:a}}},computed:{...s("app",["refundSettings"]),headers(){return[{title:"#",align:"start",sortable:!1,value:"serial"},{title:this.$i18n.t("product"),sortable:!1,value:"product"},{title:this.$i18n.t("quantity"),sortable:!1,value:"quantity"},{title:this.$i18n.t("unit_price"),sortable:!1,value:"unit_price"},{title:this.$i18n.t("total"),sortable:!1,align:"end",value:"total"}]},refundReasonsErrors(){const e=[];return this.v$.form.refund_reasons.$dirty?(!this.v$.form.refund_reasons.required&&e.push(this.$i18n.t("this_field_is_required")),e):e},refundNoteErrors(){const e=[];return this.v$.form.refund_note.$dirty?(!this.v$.form.refund_note.required&&e.push(this.$i18n.t("this_field_is_required")),e):e}},methods:{async getDetails(e){const t=await this.call_api("get",`user/refund-request/create/${e}`);t.data.success?(this.orderCode=t.data.order_code,this.order=t.data.order,this.order.products.data.forEach(e=>{let t={status:!1,order_detail_id:e.order_detail_id,quantity:e.quantity,unit_price:e.price,unit_tax:e.tax};this.form.refund_items.push(t)})):(this.snack({message:t.data.message,color:"red"}),this.$router.push({name:"404"}))},async sendRefundRequest(){if(!(await this.v$.$validate()))return;let e=this.form.refund_items.map(e=>e.status).filter(e=>e);if(0==e.length)return void this.snack({message:this.$i18n.t("please_select_a_product."),color:"red"});this.loading=!0,e=JSON.stringify(this.form.refund_items.map(e=>({order_detail_id:e.order_detail_id,quantity:e.quantity,status:e.status})).filter(e=>e.status));let t=new FormData;t.append("refund_items",e),t.append("order_id",this.order.id),t.append("refund_reasons",this.form.refund_reasons),t.append("refund_note",this.form.refund_note),this.form.attachments&&this.form.attachments.forEach((e,a)=>{t.append(`attachments[${a}]`,e)});const a=await this.call_api("post","user/refund-request/store",t,!0);a.data.success?(this.snack({message:a.data.message}),this.$router.push({name:"RefundRequests"})):this.snack({message:a.data.message,color:"red"}),this.loading=!1},calculateRefund(){let e=0;this.form.refund_items.forEach(t=>{e+=t.status?(t.unit_price+t.unit_tax)*t.quantity:0}),this.form.refund_amount=e}},created(){this.getDetails(this.$route.params.orderId)}},g={class:"ps-lg-7 pt-4"},b={class:"text-h6 fw-700 mb-2"},$={class:"d-flex align-center"},y=["src","alt"],q={class:"flex-grow-1 ms-4"},x={class:"text-truncate-2"},k={key:0,class:""},V={class:"opacity-70"},w={class:"fw-500"},R={class:"d-block fw-600"},U={class:"d-block fw-600"},E={key:0,class:"mb-3"},S={class:"mb-1 fs-13 fw-500"},j=["item"],z={class:"mb-3"},C={class:"mb-1 fs-13 fw-500"},D={class:"mb-3"},F={class:"mb-1 fs-13 fw-500"};const B=e(v,[["render",function(e,t,a,s,v,B){const N=r("v-card-title"),I=r("v-checkbox"),J=r("vue-number-input"),K=r("v-data-table"),O=r("v-card-text"),Y=r("v-card"),A=r("v-list-item"),G=r("v-select"),H=r("v-textarea"),L=r("v-chip"),M=r("v-file-input"),P=r("v-btn"),Q=r("v-form");return i(),n("div",g,[l("h1",b,d(e.$t("create_new_refund_request")),1),e.is_empty_obj(e.order)?f("",!0):(i(),o(Q,{key:0,"lazy-validation":"",onSubmit:t[6]||(t[6]=m(e=>B.sendRefundRequest(),["prevent"])),autocomplete:"chrome-off",enctype:"multipart/form-data"},{default:u(()=>[c(Y,{class:"mb-6",outlined:""},{default:u(()=>[c(N,null,{default:u(()=>[_(d(e.$t("order_code"))+": "+d(e.orderCode),1)]),_:1}),c(O,null,{default:u(()=>[c(K,{headers:B.headers,items:e.order.products.data,class:"","no-data-text":e.$t("no_data_available")||"Không có dữ liệu","hide-default-footer":"","mobile-breakpoint":"750","item-key":"order_detail_id"},{"item.serial":u(({item:t,index:a})=>[c(I,{"true-icon":"las la-check",modelValue:e.form.refund_items[a].status,"onUpdate:modelValue":t=>e.form.refund_items[a].status=t,class:"mt-1","hide-details":"",name:"order_detail_ids"},null,8,["modelValue","onUpdate:modelValue"])]),"item.product":u(({item:a})=>[l("div",$,[l("img",{src:a.thumbnail,alt:a.name,onError:t[0]||(t[0]=t=>e.imageFallback(t)),class:"size-70px flex-shrink-0"},null,40,y),l("div",q,[l("div",x,d(a.name),1),a.combinations.length>0?(i(),n("div",k,[(i(!0),n(p,null,h(a.combinations,(e,a)=>(i(),n("span",{key:a,class:"me-4 py-1 fs-12"},[l("span",V,d(e.attribute),1),t[7]||(t[7]=_(" : ",-1)),l("span",w,d(e.value),1)]))),128))])):f("",!0)])])]),"item.quantity":u(({item:t,index:a})=>[c(J,{modelValue:e.form.refund_items[a].quantity,"onUpdate:modelValue":t=>e.form.refund_items[a].quantity=t,min:1,max:t.quantity,step:1,align:"center",size:"110px"},null,8,["modelValue","onUpdate:modelValue","max"])]),"item.unit_price":u(({item:t})=>[l("span",R,d(e.format_price(t.price+t.tax)),1)]),"item.total":u(({item:t})=>[l("span",U,d(e.format_price(t.total)),1)]),_:2},1032,["headers","items","no-data-text"])]),_:1})]),_:1}),c(Y,{class:"mb-6",outlined:""},{default:u(()=>[c(N,{class:""},{default:u(()=>[_(d(e.$t("refund_information")),1)]),_:1}),c(O,null,{default:u(()=>[e.refundSettings.refund_reason_types&&e.refundSettings.refund_reason_types.length>0?(i(),n("div",E,[l("div",S,d(e.$t("refund_reasons")),1),c(G,{modelValue:e.form.refund_reasons,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.refund_reasons=t),items:e.refundSettings.refund_reason_types,label:e.$t("choose_one"),"menu-props":{offsetY:!0},onBlur:t[2]||(t[2]=t=>e.v$.form.refund_reasons.$touch()),"hide-details":"auto",flat:"",variant:"outlined",solo:"",multiple:"",required:""},{default:u(()=>[l("template",{item:{item:e.item}},[c(A,{title:e.item.title},null,8,["title"])],8,j)]),_:1},8,["modelValue","items","label"])])):f("",!0),l("div",z,[l("div",C,d(e.$t("refund_note")),1),c(H,{placeholder:e.$t("refund_note"),onBlur:t[3]||(t[3]=t=>e.v$.form.refund_note.$touch()),"hide-details":"auto",rows:"3",modelValue:e.form.refund_note,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.refund_note=t),required:"",variant:"outlined","no-resize":""},null,8,["placeholder","modelValue"])]),l("div",D,[l("div",F,d(e.$t("attachments")),1),c(M,{label:e.$t("select_images"),"prepend-icon":"",accept:"image/png, image/jpg, image/jpeg","hide-details":"auto",variant:"outlined",multiple:"",dense:"",solo:"",flat:"",clearable:"","clear-icon":"las la-times",modelValue:e.form.attachments,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.attachments=t)},{selection:u(({text:e})=>[c(L,{small:"",label:"",color:"primary"},{default:u(()=>[_(d(e),1)]),_:2},1024)]),_:1},8,["label","modelValue"])]),c(P,{type:"submit",color:"primary",elevation:"0",onClick:B.sendRefundRequest,loading:e.loading,disabled:e.loading,class:"px-10 mt-2"},{default:u(()=>[_(d(e.$t("request_refund")),1)]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1}))])}]]);export{B as default};
