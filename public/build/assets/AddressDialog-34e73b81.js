import{a as k,b as c,m as A,f as S,g as U,_ as D,h,o as i,z as _,w as g,k as d,j as m,t as o,i as r,p as f,F as p,v as w,n as F}from"./app-65cf1f07.js";const N={props:{show:{type:Boolean,required:!0,default:!1},oldAddress:{type:Object,default:()=>{}}},data:()=>({adding:!1,countriesLoaded:!1,countries:[],filteredStates:[],filteredCities:[],v$:k(),form:{id:null,address:"",postal_code:"",country:"",country_word:"",state:"",state_word:"",city:"",city_word:"",phone:""}}),validations:{form:{address:{required:c},postal_code:{required:c},country:{required:c},state:{required:c},city:{required:c},phone:{required:c}}},watch:{oldAddress(e,t){e&&!this.is_empty_obj(e)?this.processOldAddress(e):this.resetData()}},computed:{statePlaceholer(){return this.$i18n.t("select_a_state")},cityPlaceholer(){return this.$i18n.t("select_a_city")},isVisible:{get:function(){return this.show},set:function(e){}},...A("auth",["isAuthenticated","cartDrawerOpen"])},created(){this.fetchCountries()},methods:{...S("address",["addAddress"]),...U("address",["setAddresses","addGuestUserAddress"]),async fetchCountries(){if(!this.countriesLoaded){const e=await this.call_api("get","all-countries");e.data.success&&(this.countriesLoaded=!0,this.countries=e.data.data)}},async countryChanged(e){let t=this.countries.find(n=>n.id===e);this.form.country_word=t?t.name:"";const l=await this.call_api("get",`states/${this.form.country}`);l.data.success?(this.filteredStates=l.data.data,this.form.state="",this.form.city="",this.filteredCities=[]):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"})},async stateChanged(e){let t=this.countries.find(u=>u.id===this.form.country);this.form.country_word=t?t.name:"";let l=this.filteredStates.find(u=>u.id===e);this.form.state_word=l?l.name:"";const n=await this.call_api("get",`cities/${this.form.state}`);n.data.success?(this.filteredCities=n.data.data,this.form.city=""):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"})},async cityChanged(e){let t=this.filteredCities.find(l=>l.id===e);this.form.city_word=t?t.name:""},async addNewAddress(){if(!await this.v$.$validate())return;this.isAuthenticated||(this.form.guest_user_id=localStorage.getItem("shopTempUserId")||null),this.adding=!0;const t=await this.call_api("post","user/address/create",this.form);console.log(t),t.data.success?(this.addAddress(t.data.data),this.snack({message:t.data.message}),this.resetData(),this.closeDialog()):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"}),this.adding=!1},async updateAddress(){if(!await this.v$.$validate())return;this.isAuthenticated||(this.form.guest_user_id=localStorage.getItem("shopTempUserId")||null),this.adding=!0;const t=await this.call_api("post","user/address/update",this.form);console.log(this.form),console.log(t),t.data.success?(this.setAddresses(t.data.data),this.snack({message:t.data.message}),this.closeDialog()):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"}),this.adding=!1},resetData(){this.form.id=null,this.form.guest_user_id=null,this.form.address="",this.form.postal_code="",this.form.country="",this.form.state="",this.form.city="",this.form.phone="",this.v$.form.$reset()},async processOldAddress(e){let t={...e};this.form.id=t.id,this.form.address=t.address,this.form.postal_code=t.postal_code,this.form.phone=t.phone;let l=this.countries.find(a=>a.name===t.country);this.form.country=l.id,this.form.country_word=l.name,await this.countryChanged(l.id);let n=this.filteredStates.find(a=>a.name===t.state);this.form.state=n.id,this.form.state_word=n.name,await this.stateChanged(n.id);let u=this.filteredCities.find(a=>a.name===t.city);this.form.city=u.id,this.form.city_word=u.name},closeDialog(){this.isVisible=!1,this.$emit("close")}}},q={class:"white pa-5 rounded"},B={class:"mb-3"},j={class:"mb-1 fs-13 fw-500"},I={class:"mb-3"},L={class:"mb-1 fs-13 fw-500"},O={class:"mb-3"},P={class:"mb-1 fs-13 fw-500"},T={class:"mb-3"},z={class:"mb-1 fs-13 fw-500"},G={class:"mb-3"},M={class:"mb-3"},E={class:"mb-1 fs-13 fw-500"},H={class:"text-right mt-4"};function J(e,t,l,n,u,a){const b=h("v-textarea"),$=h("v-text-field"),y=h("v-autocomplete"),v=h("v-btn"),C=h("v-form"),V=h("v-dialog");return i(),_(V,{modelValue:a.isVisible,"onUpdate:modelValue":t[7]||(t[7]=s=>a.isVisible=s),"max-width":"600px","onClick:outside":a.closeDialog},{default:g(()=>[d("div",q,[m(C,{onSubmit:t[6]||(t[6]=F(s=>a.addNewAddress(),["prevent"])),autocomplete:"chrome-off"},{default:g(()=>[d("div",B,[d("div",j,o(e.$t("address")),1),m(b,{label:e.$t("address"),modelValue:e.form.address,"onUpdate:modelValue":t[0]||(t[0]=s=>e.form.address=s),"hide-details":"auto",rows:"3",required:"",variant:"outlined","no-resize":""},null,8,["label","modelValue"]),(i(!0),r(p,null,f(e.v$.form.address.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-red"},o(s.$message),1))),128))]),d("div",I,[d("div",L,o(e.$t("postal_code")),1),m($,{placeholder:e.$t("postal_code"),type:"text",modelValue:e.form.postal_code,"onUpdate:modelValue":t[1]||(t[1]=s=>e.form.postal_code=s),"hide-details":"auto",required:"",variant:"outlined"},null,8,["placeholder","modelValue"]),(i(!0),r(p,null,f(e.v$.form.postal_code.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-red"},o(s.$message),1))),128))]),d("div",O,[d("div",P,o(e.$t("country")),1),m(y,{modelValue:e.form.country,"onUpdate:modelValue":[t[2]||(t[2]=s=>e.form.country=s),a.countryChanged],items:e.countries,label:e.$t("select_country"),"hide-details":"auto",variant:"outlined","item-title":"name","item-value":"id",dense:"",autocomplete:"off","custom-filter":a.countryChanged},null,8,["modelValue","items","label","custom-filter","onUpdate:modelValue"]),(i(!0),r(p,null,f(e.v$.form.country.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-red"},o(s.$message),1))),128))]),d("div",T,[d("div",z,o(e.$t("state")),1),m(y,{modelValue:e.form.state,"onUpdate:modelValue":[t[3]||(t[3]=s=>e.form.state=s),a.stateChanged],items:e.filteredStates,"hide-details":"auto",label:a.statePlaceholer,variant:"outlined","item-title":"name","item-value":"id",dense:""},null,8,["modelValue","items","label","onUpdate:modelValue"]),(i(!0),r(p,null,f(e.v$.form.state.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-red"},o(s.$message),1))),128))]),d("div",G,[t[8]||(t[8]=d("div",{class:"mb-1 fs-13 fw-500"},"City",-1)),m(y,{modelValue:e.form.city,"onUpdate:modelValue":[t[4]||(t[4]=s=>e.form.city=s),a.cityChanged],items:e.filteredCities,label:a.cityPlaceholer,"hide-details":"auto",variant:"outlined","item-title":"name","item-value":"id",dense:""},null,8,["modelValue","items","label","onUpdate:modelValue"]),(i(!0),r(p,null,f(e.v$.form.city.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-red"},o(s.$message),1))),128))]),d("div",M,[d("div",E,o(e.$t("phone_number")),1),m($,{placeholder:e.$t("phone_number"),type:"number",modelValue:e.form.phone,"onUpdate:modelValue":t[5]||(t[5]=s=>e.form.phone=s),"hide-details":"auto",required:"",variant:"outlined"},null,8,["placeholder","modelValue"]),(i(!0),r(p,null,f(e.v$.form.phone.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-red"},o(s.$message),1))),128))]),d("div",H,[m(v,{text:"",onClick:a.closeDialog,elevation:"0",class:"mr-2"},{default:g(()=>[w(o(e.$t("cancel")),1)]),_:1},8,["onClick"]),e.is_empty_obj(l.oldAddress)?(i(),_(v,{key:1,elevation:"0",type:"submit",color:"primary",onClick:a.addNewAddress,loading:e.adding,disabled:e.adding},{default:g(()=>[w(o(e.$t("add_new")),1)]),_:1},8,["onClick","loading","disabled"])):(i(),_(v,{key:0,elevation:"0",type:"submit",color:"primary",onClick:a.updateAddress,loading:e.adding,disabled:e.adding},{default:g(()=>[w(o(e.$t("update")),1)]),_:1},8,["onClick","loading","disabled"]))])]),_:1})])]),_:1},8,["modelValue","onClick:outside"])}const Q=D(N,[["render",J]]);export{Q as A};
