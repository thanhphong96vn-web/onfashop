import{a as e,b as t,m as s,f as a,g as i,_ as d,h as o,o as l,z as r,w as n,k as c,j as m,t as u,i as h,p as f,F as p,v as g,n as y}from"./app-5a177a8d.js";const _={props:{show:{type:Boolean,required:!0,default:!1},oldAddress:{type:Object,default:()=>{}}},data:()=>({adding:!1,countriesLoaded:!1,countries:[],filteredStates:[],filteredCities:[],v$:e(),form:{id:null,address:"",postal_code:"",country:"",country_word:"",state:"",state_word:"",city:"",city_word:"",phone:""}}),validations:{form:{address:{required:t},postal_code:{required:t},country:{required:t},state:{required:t},city:{required:t},phone:{required:t}}},watch:{oldAddress(e,t){e&&!this.is_empty_obj(e)?this.processOldAddress(e):this.resetData()}},computed:{statePlaceholer(){return this.$i18n.t("select_a_state")},cityPlaceholer(){return this.$i18n.t("select_a_city")},isVisible:{get:function(){return this.show},set:function(e){}},...s("auth",["isAuthenticated","cartDrawerOpen"])},created(){this.fetchCountries()},methods:{...a("address",["addAddress"]),...i("address",["setAddresses","addGuestUserAddress"]),async fetchCountries(){if(!this.countriesLoaded){const e=await this.call_api("get","all-countries");e.data.success&&(this.countriesLoaded=!0,this.countries=e.data.data)}},async countryChanged(e){let t=this.countries.find(t=>t.id===e);this.form.country_word=t?t.name:"";const s=await this.call_api("get",`states/${this.form.country}`);s.data.success?(this.filteredStates=s.data.data,this.form.state="",this.form.city="",this.filteredCities=[]):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"})},async stateChanged(e){let t=this.countries.find(e=>e.id===this.form.country);this.form.country_word=t?t.name:"";let s=this.filteredStates.find(t=>t.id===e);this.form.state_word=s?s.name:"";const a=await this.call_api("get",`cities/${this.form.state}`);a.data.success?(this.filteredCities=a.data.data,this.form.city=""):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"})},async cityChanged(e){let t=this.filteredCities.find(t=>t.id===e);this.form.city_word=t?t.name:""},async addNewAddress(){if(!(await this.v$.$validate()))return;this.isAuthenticated||(this.form.guest_user_id=localStorage.getItem("shopTempUserId")||null),this.adding=!0;const e=await this.call_api("post","user/address/create",this.form);console.log(e),e.data.success?(this.addAddress(e.data.data),this.snack({message:e.data.message}),this.resetData(),this.closeDialog()):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"}),this.adding=!1},async updateAddress(){if(!(await this.v$.$validate()))return;this.isAuthenticated||(this.form.guest_user_id=localStorage.getItem("shopTempUserId")||null),this.adding=!0;const e=await this.call_api("post","user/address/update",this.form);console.log(this.form),console.log(e),e.data.success?(this.setAddresses(e.data.data),this.snack({message:e.data.message}),this.closeDialog()):this.snack({message:this.$i18n.t("something_went_wrong"),color:"red"}),this.adding=!1},resetData(){this.form.id=null,this.form.guest_user_id=null,this.form.address="",this.form.postal_code="",this.form.country="",this.form.state="",this.form.city="",this.form.phone="",this.v$.form.$reset()},async processOldAddress(e){let t={...e};this.form.id=t.id,this.form.address=t.address,this.form.postal_code=t.postal_code,this.form.phone=t.phone;let s=this.countries.find(e=>e.name===t.country);this.form.country=s.id,this.form.country_word=s.name,await this.countryChanged(s.id);let a=this.filteredStates.find(e=>e.name===t.state);this.form.state=a.id,this.form.state_word=a.name,await this.stateChanged(a.id);let i=this.filteredCities.find(e=>e.name===t.city);this.form.city=i.id,this.form.city_word=i.name},closeDialog(){this.isVisible=!1,this.$emit("close")}}},$={class:"white pa-5 rounded"},v={class:"mb-3"},w={class:"mb-1 fs-13 fw-500"},b={class:"mb-3"},V={class:"mb-1 fs-13 fw-500"},C={class:"mb-3"},k={class:"mb-1 fs-13 fw-500"},A={class:"mb-3"},x={class:"mb-1 fs-13 fw-500"},U={class:"mb-3"},q={class:"mb-3"},D={class:"mb-1 fs-13 fw-500"},S={class:"text-right mt-4"};const j=d(_,[["render",function(e,t,s,a,i,d){const _=o("v-textarea"),j=o("v-text-field"),I=o("v-autocomplete"),O=o("v-btn"),P=o("v-form"),L=o("v-dialog");return l(),r(L,{modelValue:d.isVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>d.isVisible=e),"max-width":"600px","onClick:outside":d.closeDialog},{default:n(()=>[c("div",$,[m(P,{onSubmit:t[6]||(t[6]=y(e=>d.addNewAddress(),["prevent"])),autocomplete:"chrome-off"},{default:n(()=>[c("div",v,[c("div",w,u(e.$t("address")),1),m(_,{label:e.$t("address"),modelValue:e.form.address,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.address=t),"hide-details":"auto",rows:"3",required:"",variant:"outlined","no-resize":""},null,8,["label","modelValue"]),(l(!0),h(p,null,f(e.v$.form.address.$errors,e=>(l(),h("p",{key:e.$uid,class:"text-red"},u(e.$message),1))),128))]),c("div",b,[c("div",V,u(e.$t("postal_code")),1),m(j,{placeholder:e.$t("postal_code"),type:"text",modelValue:e.form.postal_code,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.postal_code=t),"hide-details":"auto",required:"",variant:"outlined"},null,8,["placeholder","modelValue"]),(l(!0),h(p,null,f(e.v$.form.postal_code.$errors,e=>(l(),h("p",{key:e.$uid,class:"text-red"},u(e.$message),1))),128))]),c("div",C,[c("div",k,u(e.$t("country")),1),m(I,{modelValue:e.form.country,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.form.country=t),d.countryChanged],items:e.countries,label:e.$t("select_country"),"hide-details":"auto",variant:"outlined","item-title":"name","item-value":"id",dense:"",autocomplete:"off","custom-filter":d.countryChanged},null,8,["modelValue","items","label","custom-filter","onUpdate:modelValue"]),(l(!0),h(p,null,f(e.v$.form.country.$errors,e=>(l(),h("p",{key:e.$uid,class:"text-red"},u(e.$message),1))),128))]),c("div",A,[c("div",x,u(e.$t("state")),1),m(I,{modelValue:e.form.state,"onUpdate:modelValue":[t[3]||(t[3]=t=>e.form.state=t),d.stateChanged],items:e.filteredStates,"hide-details":"auto",label:d.statePlaceholer,variant:"outlined","item-title":"name","item-value":"id",dense:""},null,8,["modelValue","items","label","onUpdate:modelValue"]),(l(!0),h(p,null,f(e.v$.form.state.$errors,e=>(l(),h("p",{key:e.$uid,class:"text-red"},u(e.$message),1))),128))]),c("div",U,[t[8]||(t[8]=c("div",{class:"mb-1 fs-13 fw-500"},"City",-1)),m(I,{modelValue:e.form.city,"onUpdate:modelValue":[t[4]||(t[4]=t=>e.form.city=t),d.cityChanged],items:e.filteredCities,label:d.cityPlaceholer,"hide-details":"auto",variant:"outlined","item-title":"name","item-value":"id",dense:""},null,8,["modelValue","items","label","onUpdate:modelValue"]),(l(!0),h(p,null,f(e.v$.form.city.$errors,e=>(l(),h("p",{key:e.$uid,class:"text-red"},u(e.$message),1))),128))]),c("div",q,[c("div",D,u(e.$t("phone_number")),1),m(j,{placeholder:e.$t("phone_number"),type:"number",modelValue:e.form.phone,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.phone=t),"hide-details":"auto",required:"",variant:"outlined"},null,8,["placeholder","modelValue"]),(l(!0),h(p,null,f(e.v$.form.phone.$errors,e=>(l(),h("p",{key:e.$uid,class:"text-red"},u(e.$message),1))),128))]),c("div",S,[m(O,{text:"",onClick:d.closeDialog,elevation:"0",class:"mr-2"},{default:n(()=>[g(u(e.$t("cancel")),1)]),_:1},8,["onClick"]),e.is_empty_obj(s.oldAddress)?(l(),r(O,{key:1,elevation:"0",type:"submit",color:"primary",onClick:d.addNewAddress,loading:e.adding,disabled:e.adding},{default:n(()=>[g(u(e.$t("add_new")),1)]),_:1},8,["onClick","loading","disabled"])):(l(),r(O,{key:0,elevation:"0",type:"submit",color:"primary",onClick:d.updateAddress,loading:e.adding,disabled:e.adding},{default:n(()=>[g(u(e.$t("update")),1)]),_:1},8,["onClick","loading","disabled"]))])]),_:1})])]),_:1},8,["modelValue","onClick:outside"])}]]);export{j as A};
